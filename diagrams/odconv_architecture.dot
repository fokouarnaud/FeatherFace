digraph FeatherFaceODConv {
    // FeatherFace ODConv Architecture Diagram
    // Shows 4D attention mechanism replacing CBAM baseline
    
    // Graph styling
    rankdir=LR;
    bgcolor="white";
    fontname="Arial";
    fontsize=14;
    
    // Node styling
    node [fontname="Arial", fontsize=11, shape=box, style=filled];
    edge [fontname="Arial", fontsize=9];
    
    // Define subgraphs for organization
    subgraph cluster_input {
        label="Input Pipeline";
        color=lightgray;
        style=filled;
        fillcolor="#f8f9fa";
        
        input [label="Input Image\n[B, 3, 640, 640]", fillcolor="#e3f2fd"];
    }
    
    subgraph cluster_backbone {
        label="MobileNet-0.25 Backbone\n(~213K params)";
        color=lightblue;
        style=filled;
        fillcolor="#e8f4fd";
        
        stage1 [label="Stage 1\n[B, 64, H/8, W/8]", fillcolor="#bbdefb"];
        stage2 [label="Stage 2\n[B, 128, H/16, W/16]", fillcolor="#bbdefb"];
        stage3 [label="Stage 3\n[B, 256, H/32, W/32]", fillcolor="#bbdefb"];
    }
    
    subgraph cluster_odconv_backbone {
        label="ODConv Backbone Attention\n4D Multidimensional";
        color=orange;
        style=filled;
        fillcolor="#fff3e0";
        
        odconv1 [label="ODConv 4D\n64 channels\nSpatial + Input Ch\n+ Output Ch + Kernel", fillcolor="#ffcc02"];
        odconv2 [label="ODConv 4D\n128 channels\nSpatial + Input Ch\n+ Output Ch + Kernel", fillcolor="#ffcc02"];
        odconv3 [label="ODConv 4D\n256 channels\nSpatial + Input Ch\n+ Output Ch + Kernel", fillcolor="#ffcc02"];
    }
    
    subgraph cluster_bifpn {
        label="BiFPN Feature Aggregation\n(~93K params)";
        color=green;
        style=filled;
        fillcolor="#e8f5e8";
        
        bifpn [label="BiFPN\n3 levels\nBidirectional\nFeature Fusion", fillcolor="#c8e6c9"];
        p3 [label="P3\n[B, 52, H/8, W/8]", fillcolor="#a5d6a7"];
        p4 [label="P4\n[B, 52, H/16, W/16]", fillcolor="#a5d6a7"];
        p5 [label="P5\n[B, 52, H/32, W/32]", fillcolor="#a5d6a7"];
    }
    
    subgraph cluster_odconv_bifpn {
        label="ODConv BiFPN Attention\n4D Multidimensional";
        color=orange;
        style=filled;
        fillcolor="#fff3e0";
        
        odconv_p3 [label="ODConv 4D\n52 channels\nSpatial + Input Ch\n+ Output Ch + Kernel", fillcolor="#ffcc02"];
        odconv_p4 [label="ODConv 4D\n52 channels\nSpatial + Input Ch\n+ Output Ch + Kernel", fillcolor="#ffcc02"];
        odconv_p5 [label="ODConv 4D\n52 channels\nSpatial + Input Ch\n+ Output Ch + Kernel", fillcolor="#ffcc02"];
    }
    
    subgraph cluster_ssh {
        label="SSH Detection Heads\n(~165K params)";
        color=purple;
        style=filled;
        fillcolor="#f3e5f5";
        
        ssh1 [label="SSH + DCN\nP3 features", fillcolor="#ce93d8"];
        ssh2 [label="SSH + DCN\nP4 features", fillcolor="#ce93d8"];
        ssh3 [label="SSH + DCN\nP5 features", fillcolor="#ce93d8"];
    }
    
    subgraph cluster_shuffle {
        label="Channel Shuffle\n(~10K params)";
        color=teal;
        style=filled;
        fillcolor="#e0f2f1";
        
        cs1 [label="ChannelShuffle2\nInformation Mixing", fillcolor="#80cbc4"];
        cs2 [label="ChannelShuffle2\nInformation Mixing", fillcolor="#80cbc4"];
        cs3 [label="ChannelShuffle2\nInformation Mixing", fillcolor="#80cbc4"];
    }
    
    subgraph cluster_heads {
        label="Detection Heads\n(~5.5K params)";
        color=red;
        style=filled;
        fillcolor="#ffebee";
        
        cls_head [label="Classification\nFace/Background", fillcolor="#ef9a9a"];
        bbox_head [label="Bounding Box\nRegression", fillcolor="#ef9a9a"];
        ldm_head [label="Landmark\nDetection", fillcolor="#ef9a9a"];
    }
    
    subgraph cluster_output {
        label="Output";
        color=lightgray;
        style=filled;
        fillcolor="#f8f9fa";
        
        output [label="Detection Results\nBBox + Confidence\n+ Landmarks", fillcolor="#e3f2fd"];
    }
    
    // Key innovation box
    subgraph cluster_innovation {
        label="ðŸš€ ODConv Innovation vs CBAM";
        color=darkorange;
        style=filled;
        fillcolor="#fef7e0";
        
        innovation [label="4D Attention Mechanism\nâœ“ Spatial: Location-wise\nâœ“ Input Channel: Channel-wise input\nâœ“ Output Channel: Channel-wise output\nâœ“ Kernel: Kernel-wise\n\nvs CBAM (2D only):\nâœ“ Channel attention\nâœ“ Spatial attention\n\nPerformance: +3.77-5.71% ImageNet\nParameters: ~485K vs 488.7K CBAM\nComplexity: Superior long-range modeling", 
               fillcolor="#ffd54f", fontsize=10];
    }
    
    // Connection flows
    input -> stage1;
    stage1 -> odconv1;
    odconv1 -> stage2;
    stage2 -> odconv2;
    odconv2 -> stage3;
    stage3 -> odconv3;
    
    odconv1 -> bifpn;
    odconv2 -> bifpn;
    odconv3 -> bifpn;
    
    bifpn -> p3;
    bifpn -> p4;
    bifpn -> p5;
    
    p3 -> odconv_p3;
    p4 -> odconv_p4;
    p5 -> odconv_p5;
    
    odconv_p3 -> ssh1;
    odconv_p4 -> ssh2;
    odconv_p5 -> ssh3;
    
    ssh1 -> cs1;
    ssh2 -> cs2;
    ssh3 -> cs3;
    
    cs1 -> cls_head;
    cs1 -> bbox_head;
    cs1 -> ldm_head;
    
    cs2 -> cls_head;
    cs2 -> bbox_head;
    cs2 -> ldm_head;
    
    cs3 -> cls_head;
    cs3 -> bbox_head;
    cs3 -> ldm_head;
    
    cls_head -> output;
    bbox_head -> output;
    ldm_head -> output;
    
    // Performance annotations
    subgraph cluster_performance {
        label="ðŸ“Š Expected Performance (WIDERFace)";
        color=darkgreen;
        style=filled;
        fillcolor="#e8f5e8";
        
        performance [label="Easy: 94.0% (+1.3% vs CBAM 92.7%)\nMedium: 92.0% (+1.3% vs CBAM 90.7%)\nHard: 80.5% (+2.2% vs CBAM 78.3%)\nOverall: 88.8% (+1.6% vs CBAM 87.2%)\n\nScientific Foundation:\nLi et al. ICLR 2022 (Spotlight)\nSystematic Literature Review 2025", 
                   fillcolor="#c8e6c9", fontsize=10];
    }
    
    // Legend
    subgraph cluster_legend {
        label="Legend";
        color=gray;
        style=filled;
        fillcolor="#fafafa";
        
        legend [label="ðŸ”µ Backbone: MobileNet-0.25\nðŸŸ  ODConv: 4D Attention (6 modules)\nðŸŸ¢ BiFPN: Feature Aggregation\nðŸŸ£ SSH: Detection + DCN\nðŸŸ¦ Shuffle: Channel Information Mixing\nðŸ”´ Heads: Classification + Regression\n\nTotal: ~485K parameters\nvs CBAM baseline: 488.7K (-3.7K)", 
                fillcolor="#f5f5f5", fontsize=9];
    }
}