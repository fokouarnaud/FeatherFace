digraph ECAcbamArchitecture {
    // Graph configuration - Landscape orientation like CBAM baseline
    rankdir=LR;
    node [shape=box, style=filled, fontname="Arial", fontsize=10];
    edge [fontname="Arial", fontsize=9];
    
    // Title
    label="FeatherFace ECA-CBAM Hybrid Architecture (451,895 parameters)";
    labelloc="t";
    fontsize=14;
    fontname="Arial Bold";
    
    // Input
    input [label="Input Image\n640×640×3", fillcolor="#E8F4FD", color="#1E88E5"];
    
    // Backbone
    subgraph cluster_backbone {
        label="MobileNetV1-0.25 Backbone";
        style=filled;
        fillcolor="#FFF3E0";
        color="#F57C00";
        
        mobilenet [label="MobileNetV1-0.25\n213,072 params\n(47.2%)", fillcolor="#FFE0B2"];
        stage1 [label="Stage 1\nP3/8", fillcolor="#FFCC80"];
        stage2 [label="Stage 2\nP4/16", fillcolor="#FFCC80"];
        stage3 [label="Stage 3\nP5/32", fillcolor="#FFCC80"];
    }
    
    // Backbone ECA-CBAM Attention (Hybrid)
    subgraph cluster_backbone_ecacbam {
        label="Backbone ECA-CBAM Hybrid Attention";
        style=filled;
        fillcolor="#E3F2FD";
        color="#2196F3";
        
        backbone_ecacbam1 [label="ECA-CBAM\n64 ch\n101 params", fillcolor="#BBDEFB"];
        backbone_ecacbam2 [label="ECA-CBAM\n128 ch\n103 params", fillcolor="#BBDEFB"];
        backbone_ecacbam3 [label="ECA-CBAM\n256 ch\n103 params", fillcolor="#BBDEFB"];
    }
    
    // Feature Pyramid Network
    subgraph cluster_fpn {
        label="BiFPN Feature Pyramid";
        style=filled;
        fillcolor="#E8F5E8";
        color="#4CAF50";
        
        bifpn [label="BiFPN\n75,246 params\n(16.7%)", fillcolor="#C8E6C8"];
        p3_out [label="P3 Features\nout_channel=48", fillcolor="#A5D6A7"];
        p4_out [label="P4 Features\nout_channel=48", fillcolor="#A5D6A7"];
        p5_out [label="P5 Features\nout_channel=48", fillcolor="#A5D6A7"];
    }
    
    // BiFPN ECA-CBAM Attention (Hybrid)
    subgraph cluster_bifpn_ecacbam {
        label="BiFPN ECA-CBAM Hybrid Attention";
        style=filled;
        fillcolor="#E3F2FD";
        color="#2196F3";
        
        bifpn_ecacbam1 [label="ECA-CBAM\n48 ch\nP3\n101 params", fillcolor="#BBDEFB"];
        bifpn_ecacbam2 [label="ECA-CBAM\n48 ch\nP4\n101 params", fillcolor="#BBDEFB"];
        bifpn_ecacbam3 [label="ECA-CBAM\n48 ch\nP5\n101 params", fillcolor="#BBDEFB"];
    }
    
    // SSH Detection Heads
    subgraph cluster_ssh {
        label="SSH Detection Heads";
        style=filled;
        fillcolor="#EDE7F6";
        color="#673AB7";
        
        ssh1 [label="SSH1\n51,765 params\n(11.5%)", fillcolor="#D1C4E9"];
        ssh2 [label="SSH2\n51,765 params\n(11.5%)", fillcolor="#D1C4E9"];
        ssh3 [label="SSH3\n51,765 params\n(11.5%)", fillcolor="#D1C4E9"];
    }
    
    // Channel Shuffle
    subgraph cluster_shuffle {
        label="Channel Shuffle Optimization";
        style=filled;
        fillcolor="#F3E5F5";
        color="#9C27B0";
        
        cs1 [label="CS1\n0 params", fillcolor="#E1BEE7"];
        cs2 [label="CS2\n0 params", fillcolor="#E1BEE7"];
        cs3 [label="CS3\n0 params", fillcolor="#E1BEE7"];
    }
    
    // Output Heads
    subgraph cluster_outputs {
        label="Detection Outputs";
        style=filled;
        fillcolor="#FFF8E1";
        color="#FF9800";
        
        class_head [label="Classification\n552 params\n(0.1%)", fillcolor="#FFECB3"];
        bbox_head [label="BBox Regression\n1,104 params\n(0.2%)", fillcolor="#FFECB3"];
        landmark_head [label="Landmarks\n2,760 params\n(0.6%)", fillcolor="#FFECB3"];
    }
    
    // Final Outputs
    output [label="Face Detection\nResults", fillcolor="#FFCDD2", color="#F44336"];
    
    // Connections
    input -> mobilenet;
    
    mobilenet -> stage1;
    mobilenet -> stage2;
    mobilenet -> stage3;
    
    stage1 -> backbone_ecacbam1;
    stage2 -> backbone_ecacbam2;
    stage3 -> backbone_ecacbam3;
    
    backbone_ecacbam1 -> bifpn;
    backbone_ecacbam2 -> bifpn;
    backbone_ecacbam3 -> bifpn;
    
    bifpn -> p3_out;
    bifpn -> p4_out;
    bifpn -> p5_out;
    
    p3_out -> bifpn_ecacbam1;
    p4_out -> bifpn_ecacbam2;
    p5_out -> bifpn_ecacbam3;
    
    bifpn_ecacbam1 -> ssh1;
    bifpn_ecacbam2 -> ssh2;
    bifpn_ecacbam3 -> ssh3;
    
    ssh1 -> cs1;
    ssh2 -> cs2;
    ssh3 -> cs3;
    
    cs1 -> class_head;
    cs1 -> bbox_head;
    cs1 -> landmark_head;
    cs2 -> class_head;
    cs2 -> bbox_head;
    cs2 -> landmark_head;
    cs3 -> class_head;
    cs3 -> bbox_head;
    cs3 -> landmark_head;
    
    class_head -> output;
    bbox_head -> output;
    landmark_head -> output;
    
    // ECA-CBAM Hybrid Module Detail (Parallel Architecture)
    subgraph cluster_ecacbam_detail {
        label="ECA-CBAM Hybrid Module Detail (Parallel Architecture)";
        style=filled;
        fillcolor="#F0F4FF";
        color="#3F51B5";
        
        detail_input [label="Input Feature\nX ∈ ℝ^(B×C×H×W)", fillcolor="#E8EAF6", shape=ellipse];
        
        // Parallel Processing Label
        parallel_label [label="PARALLEL PROCESSING", fillcolor="#FFEB3B", shape=plaintext, fontsize=12, style=bold];
        
        // ECA Channel Attention Branch
        subgraph cluster_eca {
            label="ECA Channel Attention (22 params)";
            style=filled;
            fillcolor="#E8F5E8";
            
            eca_gap [label="GAP", fillcolor="#C8E6C8"];
            eca_conv1d [label="Conv1D\nk=ψ(C)", fillcolor="#C8E6C8"];
            eca_sigmoid [label="Sigmoid", fillcolor="#C8E6C8"];
        }
        
        eca_output [label="ECA(X)\nℝ^(B×C×H×W)", fillcolor="#C8E6C8", shape=ellipse];
        
        // CBAM SAM Branch (Parallel)
        subgraph cluster_sam {
            label="CBAM SAM (98 params)";
            style=filled;
            fillcolor="#FDE7F3";
            
            sam_pool [label="AvgPool\n+\nMaxPool", fillcolor="#F8BBD9"];
            sam_conv7x7 [label="Conv2D\n7×7", fillcolor="#F8BBD9"];
            sam_sigmoid [label="Sigmoid", fillcolor="#F8BBD9"];
        }
        
        sam_output [label="SAM(X)\nℝ^(B×C×H×W)", fillcolor="#F8BBD9", shape=ellipse];
        
        // Cross Interaction Branch
        cross_interaction [label="Cross\nInteraction\n30 params", fillcolor="#FFE0B2"];
        interaction_output [label="I(X)", fillcolor="#FFE0B2", shape=ellipse];
        
        // Fusion
        fusion [label="Hybrid Fusion\nECA(X) ⊙ SAM(X) ⊙ I(X)", fillcolor="#FFF3E0", shape=diamond];
        residual [label="Residual\nX + α·Fused", fillcolor="#FFCDD2", shape=diamond];
        
        detail_output [label="Output Feature\nY ∈ ℝ^(B×C×H×W)", fillcolor="#E8EAF6", shape=ellipse];
        
        // Parallel Processing Connections
        detail_input -> eca_gap [label="Channel", color="#4CAF50"];
        detail_input -> sam_pool [label="Spatial", color="#E91E63"];
        detail_input -> cross_interaction [label="Interaction", color="#FF9800"];
        
        // ECA Branch
        eca_gap -> eca_conv1d;
        eca_conv1d -> eca_sigmoid;
        eca_sigmoid -> eca_output;
        
        // SAM Branch
        sam_pool -> sam_conv7x7;
        sam_conv7x7 -> sam_sigmoid;
        sam_sigmoid -> sam_output;
        
        // Interaction Branch
        cross_interaction -> interaction_output;
        
        // Fusion
        eca_output -> fusion;
        sam_output -> fusion;
        interaction_output -> fusion;
        fusion -> residual;
        detail_input -> residual [label="Residual", style=dashed];
        residual -> detail_output;
    }
    
}